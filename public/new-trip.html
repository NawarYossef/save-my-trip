<!DOCTYPE html>
<html lang="en">
<head>
	<title>New Trip</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link href="https://fonts.googleapis.com/css?family=Merriweather:700|Josefin+Sans|Roboto" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css">  
  <link rel="stylesheet" type="text/css" href="stylesheets/grid.css">
  <link rel="stylesheet" href="./stylesheets/hamburger.css">
  <link rel="stylesheet" type="text/css" href="./stylesheets/new-trip.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/confetti.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.16.1/lodash.min.js"></script>
  <script src="https://unpkg.com/fuse.js@2.5.0/src/fuse.min.js"></script>
  <script src="https://screenfeedcontent.blob.core.windows.net/html/airports.js"></script>
</head>
<body>
  <header>
    <div class="header-wrapper col-12">
      <nav class="">
        <ul class=" ul-header">
          <li class="">
            <a href="#" class="hvr-underline-from-center">Trips</a>
          </li>
          <li class="">
            <a href="#" class="hvr-underline-from-center">New Trip</a>
          </li>
          <li class="log-in">
            <a href="#" class="hvr-underline-from-center">Log Out</a>
          </li>
        </ul>
      </nav>
  
      <div class="h1-wrapper">
        <h1>SaveMyTrip</h1>
      </div>
      <button class="hamburger hamburger--spin noSelect" type="button">
        <span class="hamburger-box">
          <span class="hamburger-inner"></span>
        </span>
      </button>  
    </div>
  </header>

  <main role="main">
    <script>
      $(document).ready(function() {
        function init() {
          const departureCity = document.getElementById('departure-city');
          const arrivalCity = document.getElementById('arrival-city');
          const autocompleteDeparture = new google.maps.places.Autocomplete(departureCity);
          const autocompleteArrival = new google.maps.places.Autocomplete(arrivalCity);
        }
        google.maps.event.addDomListener(window, 'load', init);	
      

      var options = {
  shouldSort: true,
  threshold: 0.4,
  maxPatternLength: 32,
  keys: [{
    name: 'iata',
    weight: 0.5
  }, {
    name: 'name',
    weight: 0.3
  }, {
    name: 'city',
    weight: 0.2
  }]
};

var fuse = new Fuse(airports, options)


var ac = $('#departure-airport')
  .on('click', function(e) {
    e.stopPropagation();
  })
  .on('focus keyup', search)
  .on('keydown', onKeyDown);

var wrap = $('<div>')
  .addClass('autocomplete-wrapper')
  .insertBefore(ac)
  .append(ac);

var list = $('<div>')
  .addClass('autocomplete-results')
  .on('click', '.autocomplete-result', function(e) {
    e.preventDefault();
    e.stopPropagation();
    selectIndex($(this).data('index'));
  })
  .appendTo(wrap);

$(document)
  .on('mouseover', '.autocomplete-result', function(e) {
    var index = parseInt($(this).data('index'), 10);
    if (!isNaN(index)) {
      list.attr('data-highlight', index);
    }
  })
  .on('click', clearResults);

function clearResults() {
  results = [];
  numResults = 0;
  list.empty();
}

function selectIndex(index) {
  if (results.length >= index + 1) {
    ac.val(results[index].iata);
    clearResults();
  }  
}

var results = [];
var numResults = 0;
var selectedIndex = -1;

function search(e) {
  if (e.which === 38 || e.which === 13 || e.which === 40) {
    return;
  }
  
  if (ac.val().length > 0) {
    results = _.take(fuse.search(ac.val()), 7);
    numResults = results.length;
    
    var divs = results.map(function(r, i) {
        return '<div class="autocomplete-result" data-index="'+ i +'">'
             + '<div><b>'+ r.iata +'</b> - '+ r.name +'</div>'
             + '<div class="autocomplete-location">'+ r.city +', '+ r.country +'</div>'
             + '</div>';
     });
    
    selectedIndex = -1;
    list.html(divs.join(''))
      .attr('data-highlight', selectedIndex);

  } else {
    numResults = 0;
    list.empty();
  }
}

function onKeyDown(e) {
  switch(e.which) {
    case 38: // up
      selectedIndex--;
      if (selectedIndex <= -1) {
        selectedIndex = -1;
      }
      list.attr('data-highlight', selectedIndex);
      break;
    case 13: // enter
      selectIndex(selectedIndex);
      break;
    case 9: // enter
      selectIndex(selectedIndex);
      e.stopPropagation();
      return;
    case 40: // down
      selectedIndex++;
      if (selectedIndex >= numResults) {
        selectedIndex = numResults-1;
      }
      list.attr('data-highlight', selectedIndex);
      break;

    default: return; // exit this handler for other keys
  }
  e.stopPropagation();
  e.preventDefault(); // prevent the default action (scroll / move caret)
}
});	
    </script>
    <section class="col-12 new-trip-form">
      <div class="form-box">
        <div class="h3-wrapper col-12">
          <h3 class="heading-for-new-trip">New Trip</h3>
          <h4>Enter your trip information below</h4>
        </div>
        <form class="col-12" id="new-trip-form">
          <div class="departure-data col-12">
            <fieldset>
              <input type="text" name="airline-choice" id="airline" placeholder="Airline.."  required="" class="airline">
              <input type="text" name="confirmation-number" id="confirmation" placeholder="Confirmation Number.."  required="" class="confirmation">
            </fieldset>
          </div>
          <div class="departure-info-wrapper col-6">
            <legend>Departure</legend>
            <fieldset name="register-info">
              <input type="text" name="city-choice" id="departure-city" placeholder="City.." required="" class="">
              <input type="text" name="airport-choice" id="departure-airport" placeholder="Airport.." required="" class="">
              <input type="text" name="terminal-choice" id="departure-terminal" placeholder="Terminal.." required="" class="">
              <input type="number" name="gate-choice" id="departure-gate" placeholder="Gate.." required="" class="">
              <input type="text" name="date" id="datepicker-1" placeholder="Date And Time.."  class="">
            </fieldset>
          </div>

          <div class="arrival-info-wrapper col-6">
            <legend>Arrival</legend>
            <fieldset name="register-info">
              <input type="text" name="city-choice" id="arrival-city" placeholder="City.." required="" class="">
              <input type="text" name="airport-choice" id="arrival-airport" placeholder="Airport.."  required="" class="">
              <input type="text" name="terminal-choice" id="arrival-termianl" placeholder="Terminal.." required="" class="">
              <input type="number" name="gate-choice" id="arrival-gate" placeholder="Gate.." required="" class="">
              <input type="text" name="date" id="datepicker-2" placeholder="Date And Time.." required="" class="">
            </fieldset>
          </div>
          <div class="btns-wrapper col-12">
            <button type="button" value="Reset">Reset</button>
            <button type="submit" value="Submit" class="save-button" >Save</button>
          </div>
        </form>
      </div>
    </section>
  </main>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCxbrnP5jd_Uq6TwZ9frPsnqhD2_wgIAnU&v=3.exp&libraries=places"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js" integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU="
  crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script type="text/javascript" src="js/new-trip.js"></script>
</body>

